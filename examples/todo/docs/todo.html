<!DOCTYPE html>  <html> <head>   <title>todo.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               todo.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h4>Alpha Simprini Todo example application.</h4>

<p>The first step is to load Alpha Simprini and the AS <code>client</code> module.
The client module includes the AS.View class and is used to generate
guis.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">AS = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;alpha_simprini&quot;</span><span class="p">)</span>
<span class="nx">AS</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This module contains Modules and Views.
More complicated modules might include a Collections object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Todo = module.exports =</span>
  <span class="nv">Models: </span><span class="k">new</span> <span class="nb">Object</span>
  <span class="nv">Views: </span><span class="k">new</span> <span class="nb">Object</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Todo.Models.List</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">List</span> <span class="k">extends</span> <span class="nx">AS</span><span class="p">.</span><span class="nx">Model</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The AS.Model.Share mixin adds features from the ShareJS library.
The ShareJS integration neccessitates a string path which is used
to inflate objects passed in through the ShareJS transport.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">AS</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">Share</span><span class="p">.</span><span class="k">extends</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;Todo.Models.List&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h4>Fields</h4>

<p>The name field is a simple string property with a default value.
It's a suitable default name for a list of things to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">@field</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nv">default: </span><span class="s2">&quot;A list of things to do...&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h4>Relationships</h4>

<p>When we embed_many items, we're creating a 1-n relationship between
Lists and Items. In coordination with AS.Model.Share, @embeds_many
stores all the embedded models within the same ShareJS document as
the list object. If we had used @has_many, they would be stored in
seperate documents with something like a foreign key relation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">@embeds_many</span> <span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="nv">model: </span><span class="o">-&gt;</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Item</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h4>Virtual Properties</h4>

<p>These virtual properties are similar to computed properties in Ember.js.
These particular properties only hinge on one real property, but they
could be connected to any number of properties (including other virtual
properties.)</p>

<p>When the 'items' collection changes, these functions are ran and the reluts
are compared to previous values. If the value is different a change event is
triggered.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">@virtual_properties</span> <span class="s2">&quot;items&quot;</span><span class="p">,</span>
    <span class="nv">items_length: </span><span class="o">-&gt;</span>
      <span class="nx">@items</span><span class="p">().</span><span class="nx">length</span>

    <span class="nv">remaining_items_length: </span><span class="o">-&gt;</span>
      <span class="nx">@items</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(item) -&gt;</span> <span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">done</span><span class="p">()).</span><span class="nx">value</span><span class="p">().</span><span class="nx">length</span>

    <span class="nv">all_done: </span><span class="o">-&gt;</span>
      <span class="nx">@remaining_items_length</span><span class="p">()</span> <span class="o">is</span> <span class="mi">0</span>

    <span class="nv">done_items_length: </span><span class="o">-&gt;</span>
      <span class="nx">@items</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(item) -&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">done</span><span class="p">()).</span><span class="nx">value</span><span class="p">().</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Todo.Models.Item</h3>

<p>These items are embedded within a Todo.Views.List</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Item</span> <span class="k">extends</span> <span class="nx">AS</span><span class="p">.</span><span class="nx">Model</span>
  <span class="nx">AS</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">Share</span><span class="p">.</span><span class="k">extends</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;Todo.Models.Item&quot;</span><span class="p">)</span>

  <span class="nx">@field</span> <span class="s2">&quot;task&quot;</span><span class="p">,</span> <span class="nv">default: </span><span class="s2">&quot;Something to do...&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h4>Field types.</h4>

<p>A field may have a type. This field is a boolean field.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">@field</span> <span class="s2">&quot;done&quot;</span><span class="p">,</span> <span class="nv">type: </span><span class="nb">Boolean</span><span class="p">,</span> <span class="nv">default: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Todo.Views.List</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">List</span> <span class="k">extends</span> <span class="nx">AS</span><span class="p">.</span><span class="nx">View</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h4>View Events</h4>

<p>Similar to Backbone.js View events these events are 'live' bound
to the container element for this view.
In this case, the jQuery for these events might look like this:</p>

<pre><code>this.el.find(".add_item").live("click", this.add_item)
this.el.find(".remove_item").live("click", this.remove_item)
this.el.find(".clear_items").live("click", this.clear_items)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">events:</span>
    <span class="s2">&quot;click .add_item&quot;</span><span class="o">:</span> <span class="s2">&quot;add_item&quot;</span>
    <span class="s2">&quot;click .remove_item&quot;</span><span class="o">:</span> <span class="s2">&quot;remove_item&quot;</span>
    <span class="s2">&quot;click .clear_items&quot;</span><span class="o">:</span> <span class="s2">&quot;clear_items&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h4>DOM Generation</h4>

<p>AlphaSimprini uses pure script to generate DOM.
All DOM is appended to a top-level @el. Which defaults to a <div>
The tagname may be spetified as:</p>

<pre><code>tag_name: "ul"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h4>editline</h4>

<p>A special content binding for use in conjuction with
AS.Model.Share. It provides a [contenteditable] <span> which is linked
"as-you-type" to other active sessions via ShareJS.</p>

<p>(We will see later, in the Application initializer, that this view has been
 constructed with a Todo.Models.List object. )</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@h1</span> <span class="o">-&gt;</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">editline</span> <span class="s2">&quot;name&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>This button is bound to the add_item method through the
events: specified at the top of the class.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@button</span> <span class="k">class</span><span class="o">:</span> <span class="s2">&quot;add_item&quot;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="s2">&quot;Add Item&quot;</span>

    <span class="nx">@label</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h4>Field/Property/Relation Binding</h4>

<p>Calling binding with field, virtual_property, or relation name creates
the appropriate databinding in the DOM. Here a function is used to specify
the content in the binding. As 'all_done' is a virtual property the contents
of this binding will be redrawn whenever the value of the property changes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@list</span><span class="p">.</span><span class="nx">binding</span> <span class="s2">&quot;all_done&quot;</span><span class="p">,</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h4>Checkbox Binding</h4>

<p>Binds the value of 'all_done' to a checkbox. This binding is two-way. Changing
the value of the checkbox changes the value on the model.
(TODO: At this moment the implementation of setting virtual properties is non-existent.
clicking this checkbox will not effect the underlying data.)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@list</span><span class="p">.</span><span class="nx">checkbox</span><span class="p">(</span><span class="s2">&quot;all_done&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">all_done</span><span class="p">()</span>
          <span class="nx">@text</span>  <span class="s2">&quot;Mark all as incomplete&quot;</span>
        <span class="k">else</span>
          <span class="nx">@text</span> <span class="s2">&quot;Mark all as complete&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>The listing method encapsulates and makes reusable the code to display a list
Items in the List.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@listing</span> <span class="s2">&quot;Things to do:&quot;</span><span class="p">,</span> <span class="nv">done: </span><span class="kc">false</span>
    <span class="nx">@listing</span> <span class="s2">&quot;Things I&#39;ve done:&quot;</span><span class="p">,</span> <span class="nv">done: </span><span class="kc">true</span>

    <span class="nx">@footer</span> <span class="o">-&gt;</span>
      <span class="nx">@span</span> <span class="o">-&gt;</span>
        <span class="nx">@list</span><span class="p">.</span><span class="nx">binding</span> <span class="s2">&quot;remaining_items_length&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nv">count = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">remaining_items_length</span><span class="p">()</span>
          <span class="nx">@span</span> <span class="s2">&quot;#{count} more #{@pluralize(&quot;</span><span class="nx">thing</span><span class="s2">&quot;, count)} to do!&quot;</span>

      <span class="nx">@span</span> <span class="o">-&gt;</span>
        <span class="nx">@list</span><span class="p">.</span><span class="nx">binding</span> <span class="s2">&quot;done_items_length&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nv">count = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">done_items_length</span><span class="p">()</span>
          <span class="k">return</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="nx">count</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">@button</span> <span class="k">class</span><span class="o">:</span> <span class="s2">&quot;clear_items&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
            <span class="s2">&quot;Clear #{count} completed #{@pluralize(&#39;item&#39;, count)}.&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>The listing "partial"</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">listing: </span><span class="nf">(label, filter) -&gt;</span>
    <span class="nx">@h2</span> <span class="nx">label</span>
    <span class="nx">@ul</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h4>Filtering Relation bindings.</h4>

<p>When binding to a collection (@has_many or @embeds_many), you may
provide a filter. In this case the filter will be on the 'done' property.
Items matching the filter will be excluded from the view. As an item's fields
and properties change it will be refiltered and possibly displayed in this binding.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@list</span><span class="p">.</span><span class="nx">binding</span> <span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="nv">filter: </span><span class="nx">filter</span><span class="p">,</span> <span class="nf">(item) -&gt;</span>
        <span class="nx">@li</span> <span class="o">-&gt;</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">checkbox</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>
          <span class="nx">@p</span> <span class="o">-&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">editline</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span>
          <span class="nv">button = </span><span class="nx">@button</span> <span class="k">class</span><span class="o">:</span> <span class="s2">&quot;remove_item&quot;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="s2">&quot;x&quot;</span>
          <span class="nx">@$</span><span class="p">(</span><span class="nx">button</span><span class="p">).</span><span class="nx">data</span><span class="p">().</span><span class="nv">item = </span><span class="nx">item</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>View Methods</h3>

<p>These are the methods bound in the events property at the top of the class.
While application state changes the View will be redrawn as warranted.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add_item: </span><span class="nf">(item) -&gt;</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">items</span><span class="p">().</span><span class="nx">add</span> <span class="k">new</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Item</span>

  <span class="nv">remove_item: </span><span class="nf">(event) -&gt;</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">items</span><span class="p">().</span><span class="nx">remove</span> <span class="nx">@$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">data</span><span class="p">().</span><span class="nx">item</span>

  <span class="nv">clear_items: </span><span class="nf">(event) -&gt;</span>
    <span class="nv">items = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">items</span><span class="p">()</span>
    <span class="nx">items</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">done</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>Todo.Application</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">Application</span> <span class="k">extends</span> <span class="nx">AS</span><span class="p">.</span><span class="nx">Application</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Because we are using ShareJS, we must "open" our List object and bind to the "ready"
event. The @params are set on the Todo namespace and passed onto the @params field
at application initialization time.</p>

<pre><code>Todo.params = {list_id: "some list"};
Todo.app = new Todo.Application()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">-&gt;</span>
    <span class="vi">@list = </span><span class="nx">Todo</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">List</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">@params</span><span class="p">.</span><span class="nx">list_id</span><span class="p">)</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">bind</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span> <span class="nx">@listready</span><span class="p">,</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>When the list is ready we create the view and pass in the list.
Then the list view is appended to the application and we're good to go.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">listready: </span><span class="o">-&gt;</span>
    <span class="vi">@list_view = </span><span class="nx">@view</span> <span class="nx">Todo</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">List</span><span class="p">,</span> <span class="nv">list: </span><span class="nx">@list</span>
    <span class="nx">@append</span> <span class="nx">@list_view</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 